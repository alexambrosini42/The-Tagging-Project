# LoRA Dataset Tagger

A powerful desktop application for efficiently reviewing, cleaning, and standardizing image tags for LoRA (Low-Rank Adaptation) training datasets.

![Python Version](https://img.shields.io/badge/python-3.7%2B-blue)
![License](https://img.shields.io/badge/license-MIT-green)
![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey)

## üìã Table of Contents

- [Overview](#overview)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Keyboard Shortcuts](#keyboard-shortcuts)
- [Project Structure](#project-structure)
- [Requirements](#requirements)
- [Contributing](#contributing)
- [License](#license)

## üéØ Overview

This application solves the time-consuming task of manually reviewing and standardizing thousands of image tags generated by automatic taggers (like Civitai's auto-tagger). It provides an intuitive interface to:

- View high-resolution images with zoom functionality
- Edit tags with a visual pill-style interface
- Get intelligent tag suggestions based on similarity and frequency
- Perform bulk operations across your entire dataset
- Maintain consistency with undo/redo functionality

The output format is standardized: each image has a corresponding `.txt` file with tags separated by comma-space (e.g., `tag1, tag2, tag3`).

## ‚ú® Features

### Image Viewer
- **High-resolution display** with Pillow (PIL) rendering
- **Zoom controls**: Zoom in (+), Zoom out (-), Reset (0)
- **Full-screen capable** image panel
- **Scrollable canvas** for large images
- Supports `.jpg`, `.jpeg`, `.png`, and `.webp` formats

### Interactive Tag Editor
- **Pill-style tags** - visual, clickable elements for each tag
- **In-place editing** - double-click any tag to edit directly
- **Quick removal** - X button on each tag
- **Reordering** - move tags up/down with arrow buttons
- **Add new tags** - simple input field with Enter key support
- **Duplicate prevention** - automatic deduplication

### Smart Suggestions
- **Global frequency list** - all tags ranked by usage across dataset
- **Local similarity suggestions** - tags similar to current image tags (configurable Levenshtein distance)
- **Real-time filtering** - search/filter tags and images
- **Double-click to add** - instant tag addition from suggestion lists

### Bulk Operations
- **Add tag globally** - add a tag to all images
- **Remove tag globally** - remove a tag from all images
- **Rename tag globally** - replace all instances of a tag (case-sensitive, with confirmation)

### History & Navigation
- **Undo functionality** (Ctrl+Z) - up to 10 operations
- **Keyboard shortcuts** - rapid navigation and editing
- **Image filtering** - show only images containing specific tags
- **Status indicators** - current position (e.g., "57 of 450")
- **Auto-save** - changes persist immediately

### Configuration
- **Recursive scanning** - optional subfolder support
- **Case enforcement** - optional lowercase conversion
- **Similarity threshold** - adjustable for tag suggestions
- **Custom separators** - configurable tag delimiter

## üöÄ Installation

### Prerequisites

- Python 3.7 or higher
- pip (Python package manager)

### Step 1: Clone the Repository

```bash
git clone https://github.com/yourusername/lora-dataset-tagger.git
cd lora-dataset-tagger
```

### Step 2: Install Dependencies

```bash
pip install -r requirements.txt
```

**Required packages:**
- `Pillow` - for image processing and display
- `tkinter` - included with most Python installations

If tkinter is not installed (rare), install it via your system package manager:

**Ubuntu/Debian:**
```bash
sudo apt-get install python3-tk
```

**macOS (Homebrew):**
```bash
brew install python-tk
```

**Windows:**
Tkinter is included with the standard Python installer.

### Step 3: Run the Application

```bash
python main.py
```

## üìñ Usage

### Getting Started

1. **Launch the application**
   ```bash
   python main.py
   ```

2. **Open your dataset folder**
   - Click `File > Open Folder` or use the menu bar
   - Select the folder containing your images and `.txt` tag files
   - The application will recursively scan for all supported images

3. **Review and edit tags**
   - Images are displayed in the left panel
   - Tags appear as interactive pills in the middle panel
   - Use suggestions from the right panel for quick tagging

### Editing Tags

**Add a new tag:**
- Type in the "Add new tag" field and press Enter or click "Add"
- Or double-click a tag from the Global/Similar lists

**Edit an existing tag:**
- Double-click the tag pill to enter edit mode
- Modify the text and press Enter or click ‚úì

**Remove a tag:**
- Click the ‚úï button on any tag pill

**Reorder tags:**
- Use the ‚ñ≤ and ‚ñº buttons to move tags up or down

### Navigation

- **Next image**: Click "Next ‚Üí" button or press `Right Arrow`
- **Previous image**: Click "‚Üê Previous" button or press `Left Arrow`
- **Save**: Click "Save" button or press `Ctrl+S`
- **Save and next**: Press `Ctrl+Right Arrow`

### Filtering

- Type in the "Filter" field to:
  - Filter the global tag list
  - Filter images by tags they contain

### Global Operations

**Add Tag to All Images:**
1. Click "Add Tag to All" in the Global Operations panel
2. Enter the tag name
3. Confirm - the tag will be added to all images that don't already have it

**Remove Tag from All Images:**
1. Click "Remove Tag from All"
2. Enter the tag name
3. Confirm - the tag will be removed from all images

**Rename Tag Globally:**
1. Click "Rename Tag Globally"
2. Enter the old tag name (case-sensitive)
3. Enter the new tag name
4. Confirm - all instances will be replaced

‚ö†Ô∏è **Note:** Global rename is case-sensitive and shows a confirmation dialog before applying changes.

### Zoom Controls

- **Zoom In**: Click "Zoom In (+)" or press `+`
- **Zoom Out**: Click "Zoom Out (-)" or press `-`
- **Reset Zoom**: Click "Reset (0)" or press `0`
- Current zoom level is displayed (e.g., "150%")

### Undo

- Press `Ctrl+Z` or select `Edit > Undo`
- Undoes the last save operation
- History stack maintains up to 10 operations (configurable)

## ‚öôÔ∏è Configuration

Edit `main.py` to customize application behavior:

```python
# Maximum Levenshtein distance for similarity suggestions
SIMILARITY_THRESHOLD = 2

# Scan subfolders for images
ENABLE_RECURSIVE_SCAN = True

# Convert all tags to lowercase on save
ENFORCE_LOWERCASE = False

# Tag separator in .txt files
TAG_SEPARATOR = ", "

# Maximum undo operations
HISTORY_MAX_DEPTH = 10

# Supported image formats
SUPPORTED_FORMATS = ('.jpg', '.jpeg', '.png', '.webp')
```

## ‚å®Ô∏è Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| `Ctrl+Z` | Undo last operation |
| `Ctrl+S` | Save current tags |
| `Right Arrow` | Next image |
| `Left Arrow` | Previous image |
| `Ctrl+Right Arrow` | Save and move to next |
| `+` | Zoom in |
| `-` | Zoom out |
| `0` | Reset zoom to 100% |
| `Enter` | Add new tag (when in text field) |
| `Escape` | Cancel tag editing |

## üìÅ Project Structure

```
lora-dataset-tagger/
‚îÇ
‚îú‚îÄ‚îÄ main.py              # Application entry point and configuration
‚îú‚îÄ‚îÄ data_manager.py      # Data manipulation and file I/O backend
‚îú‚îÄ‚îÄ gui_app.py           # GUI interface and user interaction
‚îú‚îÄ‚îÄ README.md            # This file
‚îî‚îÄ‚îÄ requirements.txt     # Python dependencies
```

### Module Descriptions

**`main.py`**
- Configuration constants
- Application initialization
- Entry point

**`data_manager.py`**
- Dataset loading and scanning
- Tag frequency analysis
- File reading/writing
- Similarity calculations (Levenshtein distance)
- Global operations (add/remove/rename)
- Undo history management

**`gui_app.py`**
- Tkinter-based user interface
- Image viewer with zoom
- Interactive tag editor (pill-style)
- Suggestion panels (global/local)
- Navigation controls
- Keyboard shortcuts
- Status feedback

## üì¶ Requirements

Create a `requirements.txt` file with:

```
Pillow>=9.0.0
```

Tkinter is included with standard Python installations on Windows and macOS. Linux users may need to install it separately.

## ü§ù Contributing

Contributions are welcome! Here's how you can help:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

### Development Guidelines

- Follow PEP 8 style guide
- Add docstrings to all functions
- Test on multiple platforms if possible
- Update README for new features

## üìÑ License

This project is licensed under the MIT License - see below for details:

```
MIT License

Copyright (c) 2024

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

## üôè Acknowledgments

- Built for the AI art and LoRA training community
- Designed to work with Civitai auto-tagger outputs
- Inspired by the need for efficient dataset curation

## üìû Support

For issues, questions, or suggestions:
- Open an issue on GitHub
- Check existing issues for solutions
- Contribute to discussions

---

**Happy Tagging! üè∑Ô∏è‚ú®**